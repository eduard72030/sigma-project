<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SigmaOS | Workspace</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0a; --accent: #00ff41; --window-bg: #161616; --header: #222; }
        * { box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; background: var(--bg); color: white;
            margin: 0; height: 100vh; overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #111 0%, #000 100%);
        }

        /* BARRA SUPERIOR ESTATICA */
        .top-bar {
            height: 40px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            display: flex; align-items: center; padding: 0 20px; gap: 20px;
            border-bottom: 1px solid #333; position: fixed; width: 100%; z-index: 10000;
        }
        .stat { font-size: 0.8rem; font-weight: 800; color: var(--accent); }

        /* VENTANAS PRO */
        .window {
            position: absolute; background: var(--window-bg); border-radius: 12px;
            border: 1px solid #333; display: flex; flex-direction: column;
            min-width: 250px; min-height: 200px; box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            overflow: hidden; resize: both; /* Permite cambiar tama침o */
        }
        .win-header {
            background: var(--header); padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            user-select: none; font-size: 0.7rem; font-weight: 900; text-transform: uppercase;
        }
        .win-content { padding: 15px; flex: 1; overflow-y: auto; position: relative; }

        /* FLAPPY CANVAS ADAPTATIVO */
        canvas { background: #000; width: 100%; height: 100%; border-radius: 8px; display: block; }

        /* BOTONES SIGMA */
        button { 
            background: #333; color: white; border: none; padding: 8px 12px; 
            border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold;
        }
        button:hover { background: var(--accent); color: black; }
        .option-btn { width: 100%; text-align: left; margin: 5px 0; background: #222; }

        /* CLICKER WIDGET */
        #sigma-clicker { text-align: center; }
        .sigma-btn { font-size: 3rem; cursor: pointer; transition: 0.1s; }
        .sigma-btn:active { transform: scale(0.9); }

        /* TRADER */
        .price-up { color: var(--accent); }
        .price-down { color: #ff4444; }

        .desc { font-size: 0.7rem; color: #888; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="top-bar">
    <span style="font-weight: 900; letter-spacing: 2px;">SIGMA OS</span>
    <span class="stat">CASH: $<span id="bar-money">0</span></span>
    <span class="stat">MIND: <span id="bar-mind">50</span></span>
    <span class="stat">RESPECT: <span id="bar-res">50</span></span>
</div>

<div class="window" style="top: 60px; left: 20px; width: 300px; height: 320px;" id="win-clicker">
    <div class="win-header">游눯 Money Printer</div>
    <div class="win-content" id="sigma-clicker">
        <div class="sigma-btn" onclick="doClick()">游</div>
        <h2 id="disp-money">$0</h2>
        <div class="desc">Haz clic para generar capital.</div>
        <button onclick="buyUpgrade()" id="btn-upgrade">Mejorar Clic ($15)</button>
    </div>
</div>

<div class="window" style="top: 60px; left: 340px; width: 500px; height: 400px;" id="win-flappy">
    <div class="win-header">游냕 Flappy & Editor</div>
    <div class="win-content">
        <div style="margin-bottom:10px; display:flex; gap:5px;">
            <button onclick="fMode='play'">Jugar</button>
            <button onclick="fMode='edit'">Editor</button>
            <button onclick="fMode='auto'">Generar Nivel</button>
            <button onclick="resetPipes()" style="background:#400">Limpiar</button>
        </div>
        <canvas id="fCanvas" width="800" height="450"></canvas>
    </div>
</div>

<div class="window" style="top: 400px; left: 20px; width: 400px; height: 300px;" id="win-decisions">
    <div class="win-header">游 Decisiones Cr칤ticas</div>
    <div class="win-content">
        <div id="q-text" style="font-weight:bold; margin-bottom:10px;">Cargando...</div>
        <div id="q-options"></div>
    </div>
</div>

<div class="window" style="top: 480px; left: 440px; width: 300px; height: 250px;" id="win-trader">
    <div class="win-header">游늳 Mercado Sigma</div>
    <div class="win-content" style="text-align:center">
        <div id="t-price" style="font-size:2rem; font-weight:900;">$100</div>
        <p class="desc">Activos: <span id="t-assets">0</span></p>
        <button onclick="trade('buy')">COMPRAR</button>
        <button onclick="trade('sell')" style="background:#600">VENDER</button>
    </div>
</div>

<script>
    // --- MOTOR DE VENTANAS (DRAG) ---
    document.querySelectorAll('.win-header').forEach(header => {
        header.onmousedown = function(e) {
            let win = header.parentElement;
            win.style.zIndex = 1000;
            let shiftX = e.clientX - win.getBoundingClientRect().left;
            let shiftY = e.clientY - win.getBoundingClientRect().top;
            function moveAt(pageX, pageY) {
                win.style.left = pageX - shiftX + 'px';
                win.style.top = pageY - shiftY + 'px';
            }
            function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
            document.addEventListener('mousemove', onMouseMove);
            document.onmouseup = function() {
                document.removeEventListener('mousemove', onMouseMove);
                document.onmouseup = null;
            };
        };
    });

    // --- LOGICA GLOBAL ---
    let state = JSON.parse(localStorage.getItem('sigmaOS_Save')) || {
        money: 0, mind: 50, res: 50, cVal: 1, cCost: 15, assets: 0, pipes: []
    };
    function save() { 
        localStorage.setItem('sigmaOS_Save', JSON.stringify(state)); 
        document.getElementById('bar-money').innerText = Math.floor(state.money);
        document.getElementById('disp-money').innerText = "$" + Math.floor(state.money);
        document.getElementById('bar-mind').innerText = state.mind;
        document.getElementById('bar-res').innerText = state.res;
        document.getElementById('btn-upgrade').innerText = `Mejorar Clic ($${state.cCost})`;
    }

    // --- CLICKER ---
    function doClick() { state.money += state.cVal; save(); }
    function buyUpgrade() {
        if(state.money >= state.cCost) {
            state.money -= state.cCost; state.cVal++; state.cCost *= 2; save();
        }
    }

    // --- FLAPPY ENGINE (COLISIONES REALES) ---
    const canvas = document.getElementById('fCanvas');
    const ctx = canvas.getContext('2d');
    let fMode = 'edit', birdY = 200, birdV = 0;

    canvas.onmousedown = (e) => {
        if(fMode === 'edit') {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            state.pipes.push({x: x, h: y, w: 50}); save();
        } else { birdV = -7; }
    };

    function resetPipes() { state.pipes = []; save(); }

    function flappyUpdate() {
        ctx.fillStyle = "black"; ctx.fillRect(0,0,800,450);
        
        if(fMode === 'auto' && state.pipes.length < 5) {
            for(let i=0; i<5; i++) state.pipes.push({x: 200 + i*300, h: Math.random()*250+50, w:50});
            fMode = 'play';
        }

        ctx.fillStyle = "#ff4444";
        state.pipes.forEach(p => {
            ctx.fillRect(p.x, 0, p.w, p.h); // Tubo superior
            ctx.fillRect(p.x, p.h + 120, p.w, 450); // Tubo inferior (hueco de 120)

            if(fMode === 'play' || fMode === 'auto') {
                p.x -= 4; if(p.x < -60) p.x = 850;
                // COLISI칍N REAL (hitbox 30x30 aprox para el emoji)
                if(80 > p.x && 40 < p.x + p.w) {
                    if(birdY < p.h || birdY > p.h + 110) { 
                        birdY = 200; birdV = 0; // MUERE: Reinicio
                    }
                }
            }
        });

        ctx.font = "40px Arial"; ctx.fillText("游", 40, birdY);
        if(fMode === 'play' || fMode === 'auto') {
            birdV += 0.4; birdY += birdV;
            if(birdY > 450 || birdY < 0) { birdY = 200; birdV = 0; }
        }
        requestAnimationFrame(flappyUpdate);
    }
    flappyUpdate();

    // --- DECISIONES (50 Situaciones) ---
    const situaciones = [
        {q:"Un banco te ofrece un pr칠stamo al 0%.", o:[{t:"Lo usas para invertir (Cash +200)", r:0, d:200},{t:"Sospechas y rechazas (Res +20)", r:20, d:0}]},
        {q:"Alguien te dice que 'el grind' es t칩xico.", o:[{t:"Le bloqueas (Res +30)", r:30, d:0},{t:"Intentas explicarle (Mind -20)", r:0, d:0, m:-20}]},
        {q:"Hackean tu cuenta de trading.", o:[{t:"Recuperas todo con Python (Mind +50)", r:20, d:0, m:50},{t:"Pierdes capital (Cash -100)", r:-10, d:-100}]},
        // ... (A침adidas din치micamente)
    ];
    // Rellenamos situaciones extra para llegar a 50
    for(let i=0; i<47; i++) situaciones.push({q:`Dilema Sigma #${i+4}: 쮸cci칩n o Paciencia?`, o:[{t:"Actuar (Res +10)", r:10, d:5},{t:"Esperar (Mind +10)", r:5, d:0}]});

    function loadQ() {
        let s = situaciones[Math.floor(Math.random()*situaciones.length)];
        document.getElementById('q-text').innerText = s.q;
        document.getElementById('q-options').innerHTML = s.o.map(o => 
            `<button class="option-btn" onclick="state.res+=${o.r}; state.money+=${o.d||0}; loadQ(); save();">${o.t}</button>`
        ).join('');
    }
    loadQ();

    // --- TRADER ---
    let price = 100;
    setInterval(() => {
        let c = Math.floor(Math.random()*40)-20; price += c;
        if(price < 5) price = 5;
        let el = document.getElementById('t-price');
        el.innerText = "$"+price;
        el.className = c >= 0 ? "price-up" : "price-down";
    }, 1500);

    function trade(t) {
        if(t=='buy' && state.money >= price) { state.money -= price; state.assets++; }
        if(t=='sell' && state.assets > 0) { state.money += price; state.assets--; }
        document.getElementById('t-assets').innerText = state.assets;
        save();
    }

    save(); // Init
</script>

</body>
</html>
